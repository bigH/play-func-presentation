<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>Play Framework Constructs</title>

        <meta name="description" content="Func-tastic ways of Slicing and Dicing Play">
        <meta name="author" content="Hiren Hiranandani">

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.min.css">
        <link rel="stylesheet" href="css/theme/night.css" id="theme">

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <style>
            .left {
                text-align:left;
            }

            .right {
                text-align:left;
            }

            .logo_container {
                background-color: #fff;
                border: none;
                border-radius: 30px;
                padding: 50px;
            }
        </style>

        <!-- If the query includes 'print-pdf', include the PDF print sheet -->
        <script>
            if( window.location.search.match( /print-pdf/gi ) ) {
                var link = document.createElement( 'link' );
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = 'css/print/pdf.css';
                document.getElementsByTagName( 'head' )[0].appendChild( link );
            }
        </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal">
            <div class="slides">
                <section>
                    <section>
                        <h2 style="margin-bottom: 50px; color: #cfc;">Hiren Hiranandani</h2>
                        <h5>github: @bigH</h5>
                        <h5>twitter: @hhiranan</h5>
                        <!-- TODO: title case?? -->
                    </section>
                    <section>
                        <img height="500" width="900" src="img/guitar.gif">
                    </section>
                    <section>
                        <img src="img/haskell.jpg">
                    </section>
                    <section>
                        <img height="500" width="900" src="img/cook.gif">
                    </section>
                    <section>
                        <img height="500" width="700" src="img/metal.gif">
                    </section>
                    <section>
                        <img height="500" width="700" src="img/hip-hop.gif">
                    </section>
                    <section>
                        <img height="500" width="900" src="img/quake.gif">
                    </section>
                    <section>
                        <div class="logo_container" style="margin-bottom: 50px;">
                            <img height="150" width="900" style="box-shadow: none; border: none;" src="img/bold-radius.png">
                        </div>
                        <ul>
                            <li>Typesafe Certified Training</li>
                            <li>Custom Scala Training</li>
                            <li>Code-Review</li>
                            <li>Mentoring</li>
                            <li>Development</li>
                        </ul>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">&quot;Scala Guy&quot;</h2>
                        <ul>
                            <li>Do it in Scala!</li>
                            <li>Awesome Libraries</li>
                            <li>Awesome Frameworks</li>
                            <li>Fast Evolving Language</li>
                            <li>Reactive == Win</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <div class="left">
                        <h1 style="margin-bottom: 50px; color: #cfc;"><em>Play Framework<br/>Constructs:</em></h1>
                        <h3 style="margin-bottom: 50px;">Func-tastic ways of Slicing &amp; Dicing Play</h3>
                        <h5 class="right">by <em style="color:#8f8">Hiren Hiranandani</em></h5>
                    </div>
                </section>

                </section>
                    <h2 style="margin-bottom: 50px;">Poll</h2>
                    <ul>
                        <li class="fragment">Who here is comfortable with FP?</li>
                        <li class="fragment">Who here is using Play?</li>
                        <li class="fragment">Who here is using Play at work?</li>
                    </ul>
                <section>
<!--
                <section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Terminology</h2>
                        <h5 class="fragment" style="margin-bottom: 50px;">Commonly used in the Functional Programming world</h2>
                        <ul>
                            <li class="fragment">Simple - it solves my use case</li>
                            <li class="fragment">Elegant - the only use case is making me feel smart</li>
                            <li class="fragment">Minimal - you're going to have to write more code than I did</li>
                            <li class="fragment">Configurable - it's your job to make it usable</li>
                        </ul>
                        <h5 class="fragment" style="margin-top: 50px;">
                            Shamelessly &quot;borrowed&quot; from <em>@tef</em><br/>
                            of <span style="color: #8f8">programmingisterrible.com</span> fame
                        </h2>
                    </section>
                </section>
-->
                <section>
                    <section>
                        <h2>What is Play Framework?</h2>
                        <h3>(read) Quick History Lesson</h3>
                        <h3>... emphasis on <span style="color: #8f8;">Quick</span></h3>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Web Frameworks</h2>
                        <ul>
                            <li>Rails</li>
                            <li>Django</li>
                            <li>Spring MVC</li>
                        </ul>
                    </section>
                    <section>
                        <img height="400" width="900" src="img/shrug.gif">
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Then Came Scala</h2>
                        <h3>.. and Lift</h3>
                        <ul>
                            <li>Novel in Many Ways</li>
                            <li>Painful in Many Ways</li>
                            <li>Focus on Community was Lacking</li>
                        </ul>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Play Grows Up</h2>
                        <ul>
                            <li>Nice Mix of FP</li>
                            <li>Plays Nice with other Technology</li>
                            <li>Blend of the Best
                                <ul>
                                    <li>MVC Capable</li>
                                    <li>Solid Templates</li>
                                    <li>Great JSON Support</li>
                                    <li>Incremental Compilation</li>
                                </ul>
                            </li>
                            <li>Leveraging Scala the Right Way!</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Quick Tour of Play</h2>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Get Started</h2>
                        <ul>
                            <li class="fragment">Download <a href="https://typesafe.com/activator">Activator</a></li>
                            <li class="fragment">Unzip and add to <code>PATH</code></li>
                            <li class="fragment">Run <code>activator new</code></li>
                        </ul>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Creating a New App</h2>
                        <!-- TODO: Redo GIF -->
                        <img class="fragment" src="img/activator-new.gif">
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">App Complete!</h2>
                        <img height="400" width="900" src="img/shipeh.gif">
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Details</h2>
                        <!-- TODO: Redo GIF (maybe fragment or explore structure in the previous slide) -->
                        <img class="fragment" src="img/activator-incremental-compile.gif">
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Out of the Box You Get...</h2>
                        <ul>
                            <li>Fully Configured Build</li>
                            <li>Fully Functioning Scala Project</li>
                            <li>Comes with Tests</li>
                            <li>Comes with Tools</li>
                            <li>IntelliJ: 'activator idea'</li>
                            <li>Eclipse: 'activator eclipse'</li>
                        </ul>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Play == Win</h2>
                        <img height="500" width="700" src="img/win.gif">
                    </section>
                </section>

                <section>
                    <section>
                        <h2 style="margin-bottom: 50px;">The M-word</h2>
                        <h3>Well Known Monads</h3>
                    </section>
                    <section>
                        <img src="img/monads.jpg">
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Explaining Monads</h2>
                        <ul>
                            <li>Managing Computation</li>
                            <li>Well-Defined Semantics</li>
                            <li>Well-Defined Interface(s)</li>
                        </ul>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Well Known Monads</h2>
                        <h3><code>Option[T]</code></h3>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
val father = if (person == null) null else person.father
val mother = if (father == null) null else father.mother
val sister = if (mother == null) null else mother.sister
                        </code></pre>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
for {
  father &lt;- person.father
  mother &lt;- father.mother
  sister &lt;- mother.sister
} yield sister
                        </code></pre>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Well Known Monads</h2>
                        <h3><code>Try[T]</code></h3>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def tryReadInt(prompt: String) = Try(readLine(prompt)) map (_.toInt)

def divide: Try[Int] = {
  val problem = for {
    numerator &lt;- tryReadInt("Enter Numerator:\n")
    denominator &lt;- tryReadInt("Enter Denominator:\n")
  } yield (numerator / denominator)
  problem orElse {
    println("Y U NO Make Sense! Try again.")
    divide
  }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Well Known Monads</h2>
                        <h3><code>Future[T]</code></h3>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def getUser(id: String): Future[User]
def getCart(user: User): Future[Cart]
def getFriends(user: User): Future[List[User]]
def getAffiliations(user: User): Future[List[Affiliation]]
                        </code></pre>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
for {
  user &lt;- getUser(id)

  futureCart = getCart(user)
  futureFriends = getFriends(user)
  futureAffiliations = getAffiliations(user)

  cart &lt;- futureCart
  friends &lt;- futureFriends
  affiliations &lt;- futureAffiliations
} yield Response(...)
                        </code></pre>
                    </section>
                    <section>
                        <img height="500" width="800" src="img/daftfistbump.gif">
                    </section>
                </section>

                <section>
                    <section>
                        <h2 style="margin-bottom: 50px;">The Functions You See</h2>
                        <h3>Controllers == Functions</h3>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">By Default...</h2>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
class Controller {
    def index = ActionBuilder {
        // perform business logic and/or retrieve data
        // set up view model
        // render view model using templates
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Composition</h2>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
trait FunctionalController {
  def builder: ActionBuilder
  def failureView(ex: Throwable): Html
  def action[A](logic: => A,
                renderer: A => Html,
                failure: Throwable => Html = failureView) = builder {
    Try(logic) map renderer match {
      case Success(view) => Ok(view)
      case Failure(ex)   => Error(failure(ex))
    }
  }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Composition</h2>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
class Search extends FunctionalController {
  def Builder = MySpecialAction
  def failureView = views.search.failed

  def search(term: String) = action (
    logic = performSearch(term),
    renderer = views.search.results
  )
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">The Functions You See</h2>
                        <h3>Views == Functions</h3>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Layouts</h2>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
trait FunctionalController {
  def layout: Html => Html
  def action[A](logic: => A,
                renderer: A => Html,
                failure: ...) = builder {
    Try(logic) map (renderer andThen layout) match {
      case Success(view) => Ok(view)
      case Failure(ex)   => Error(failure(ex))
    }
  }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Bigger Layouts</h2>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
type Layout = Html => Html

def composeLayout(views: Map[String, Future[Html]],
                  layout: Map[String, Html] => Layout): Future[Layout] = {
  val listOfFutureTuples = views map {
    case (name, fHtml) => fHtml map ((name, _))
  }
  Future sequence listOfFutureTuples map (_.toMap) map layout
}
                        </code></pre>
                    </section>
                    <section>
                        <img height="500" width="700" src="img/dunk.gif">
                    </section>
                </section>

                <section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Service as a Function</h2>
                        <h3>REST with Functional Style</h3>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Some Definitions</h2>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
type Service[In, Out] = (In => Future[Out])
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
type Map[A, B, In, Out] =
  (A, Service[In, Out]) => Future[B]
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
type Filter[In, Out] = Map[In, Out, In, Out]
                        </code></pre>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Can't Get it Dirty</h2>
                        <img class="fragment" height="500" width="600" src="img/clean.gif">
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Usage: Timer</h2>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
type Filter[In, Out] = (In, Service[In, Out]) => Future[Out]
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
class Timer[A, B](name: String) extends Filter[A, B] {
  def now = System.currentTimeMillis
  def apply(a: A, service: Service[A, B]): Future[B] = {
    val start = now
    service(a).map {
      result => {
        recordTime(name, now - start)
        result
      }
    }
  }
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Usage: AwesomeFilter</h2>
                        <pre><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
type Filter[In, Out] = (In, Service[In, Out]) => Future[Out]
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
val filter: Filter[In, Out] = _
val inner: Service[In, Out] = _
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
val outer: Service[In, Out] = filter(_, inner)
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
class AwesomeFilter[A, B](name: String,
                          defaults: List[Filter[A, B]])
      extends Filter[A, B] {
  var filters = defaults
  def addFilter(filter: Filter[A, B]) { ... }
  def apply(a: A, service: Service[A, B]): Future[B] = {
    filters.foldRight(service)((filter, acc) => filter(_, acc))
  }
}
                        </code></pre>
                    </section>
                    <section>
                        <img class="fragment" height="500" width="700" src="img/carlton.gif">
                    </section>
                </section>

                <section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Application as a Function</h2>
                        <h3>Seeing Everything as a Function</h3>
                    </section>
                    <section>
                        <img class="fragment" height="400" width="900" src="img/matrix.gif">
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">The Premise</h2>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
application: Configuration => Service[Request, Response]
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
class Dependencies(configuration: Configuration) {
  val db = DB(configuration)
  val system = System(configuration)
}
                        </code></pre>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">How It's Done</h2>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def configuration = Configuration.current
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def service: Dependencies => Service[Request, Response] = ???
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def applicationBuilder = Dependencies.apply andThen service
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def application = applicationBuilder(configuration)
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def action = ActionBuilder { application }
                        </code></pre>
                    </section>
                    <section>
                        <img class="fragment" height="500" width="600" src="img/stewart-win.gif">
                    </section>
                </section>

                <section>
                    <section>
                        <h2 style="margin-bottom: 50px;">The M-word continues...</h2>
                        <h3>Monads for Better Play</h3>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">The Reader Monad</h2>
                        <ul>
                            <li class="fragment">Analogous to Functions: <code>Reader[A, B]</code> = <code>A => B</code></li>
                            <li class="fragment">Describe a computation that has a <em>Dependency</em></li>
                            <li class="fragment">Richer than functions</li>
                        </ul>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">The Reader Monad</h2>
                        <h3>Let's Rewrite <code>application</code></h3>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def service: Dependencies => Service[Request, Response] = ???
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def applicationBuilder = Reader(Dependencies.apply) map service
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def application = applicationBuilder(Configuration.current)
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def action = ActionBuilder { application }
                        </code></pre>
                        <p class="fragment">I don't need to rebuild my Dependencies object every time!</p>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">The Reader Monad</h2>
                        <h3>&quot;Performance&quot;</h3>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def service: Dependencies => Service[Request, Response] = ???
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
var currentConfiguration = Configuration.current
def applicationBuilder = Reader(Dependencies.apply) map service
def buildApplication = applicationBuilder(currentConfiguration)
var currentApplication = buildApplication
                        </code></pre>
                        <pre class="fragment"><code data-trim contenteditable style="font-size: 18px; margin-top: 20px;">
def application = if (currentConfiguration eq Configuration.current) {
                    currentApplication
                  } else {
                    currentConfiguration = Configuration.current
                    currentApplication = buildApplication(currentConfiguration)
                    currentApplication
                  }
                        </code></pre>
                        <p class="fragment">Put it in a <code>trait</code> and forget about it!</p>
                    </section>
                    <section>
                        <img class="fragment" height="350" width="800" src="img/travolta-win.gif">
                    </section>
                </section>

                <section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Useful Tools</h2>
                        <h3>Reducing Boilerplate</h3>
                    </section>
                    <section>
                        <h2 style="margin-bottom: 50px;">Remember...</h2>
                        <ul>
                            <li class="fragment"><code>sbt</code> build is a Scala program</li>
                            <li class="fragment"><code>sbt-boilerplate</code> - an <code>sbt</code> plugin</li>
                            <li class="fragment">writing an embedded DSL in Scala is easy (see other talks)</li>
                            <li class="fragment">writing a language in Scala is easy (parser-combinators)</li>
                            <li class="fragment">that we also have macros</li>
                        </ul>
                    </section>
                    <section>
                        <img class="fragment" height="500" width="700" src="img/willsmithdance.gif">
                    </section>
                </section>

                <section>
                    <section>
                        <img class="fragment" height="500" width="800" src="img/end.gif">
                    </section>
                    <section>
                        <img class="fragment" src="img/qna.gif">
                    </section>
                </section>

            </div>

        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.min.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                slideNumber: true,
                history: true,
                center: true,
                previewLinks: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

                // Parallax scrolling
                // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
                // parallaxBackgroundSize: '2100px 900px',

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
                ]
            });

        </script>

    </body>
</html>
